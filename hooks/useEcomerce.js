import{useState}from"react";import ProductRepository from"~/repositories/ProductRepository";import{useCookies}from"react-cookie";import{useDispatch}from"react-redux";import{setCompareItems,setWishlistTtems,setCartItems}from"~/store/ecomerce/action";export default function useEcomerce(){const a=useDispatch(),[b,c]=useState(!1),[d]=useState(null),[e,f]=useCookies(["cart"]),[g,h]=useState([]);return{loading:b,cartItemsOnCookie:d,products:g,getProducts:async(a,b="")=>{if(c(!0),a&&0<a.length){let d="";a.forEach(a=>{a.isService?""===d?d=`S~${a.id}`:d+=`/S~${a.id}`:""===d?d=`${a.id}`:d+=`/${a.id}`});const e=await ProductRepository.getProductsByIds(d);if(e&&0<e.length){if("cart"===b){const b=e;a.forEach((a,c)=>{a.id===b[c].id&&(b[c].quantity=parseInt(a.quantity),b[c].price=parseFloat(a.price))}),h(b)}else h(e);setTimeout(function(){c(!1)}.bind(this),250)}}else c(!1),h([])},increaseQty:(b,c)=>{let d=[];if(c){d=c;const e=d.find(a=>a.id===b.id);e&&++e.quantity,f("cart",d,{path:"/"}),a(setCartItems(d))}return d},decreaseQty:(b,c)=>{let d=[];if(c){d=c;const e=d.find(a=>a.id===b.id);e&&1<e.quantity&&--e.quantity,f("cart",d,{path:"/"}),a(setCartItems(d))}return d},addItem:(b,c,d)=>{let e=[];if(c){e=c;const a=c.find(a=>a.id===b.id);a?"cart"===d&&(a.quantity+=parseInt(b.quantity),a.price=parseFloat(b.price)):(console.log("newItem",b),e.push(b))}else console.log("No Item",b),e.push(b);return"cart"===d&&(f("cart",e,{path:"/"}),a(setCartItems(e))),"wishlist"===d&&(f("wishlist",e,{path:"/"}),a(setWishlistTtems(e))),"compare"===d&&(f("compare",e,{path:"/"}),a(setCompareItems(e))),e},removeItem:(b,c,d)=>{const e=c;if(0<e.length){const a=e.findIndex(a=>a.id===b.id);e.splice(a,1)}"cart"===d&&(f("cart",e,{path:"/"}),a(setCartItems(e))),"wishlist"===d&&(f("wishlist",e,{path:"/"}),a(setWishlistTtems(e))),"compare"===d&&f("compare",e,{path:"/"})},removeItems:b=>{"wishlist"===b&&(f("wishlist",[],{path:"/"}),a(setWishlistTtems([]))),"compare"===b&&(f("compare",[],{path:"/"}),a(setCompareItems([]))),"cart"===b&&(f("cart",[],{path:"/"}),a(setCartItems([])))}}}